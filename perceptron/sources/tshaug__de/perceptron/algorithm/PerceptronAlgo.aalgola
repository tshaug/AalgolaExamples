namespace aalgola://tshaug.de/perceptron/algorithm/

import //tshaug.de/perceptron/math/FeatureVector4D    
import //aalgola.org/core/collection/cdt/array/Array

âŸ¦publicâŸ§
object PerceptronAlgo âŒ
	This class implemented the Perceptron algorithm 
	Since ôŠ¨–lgola is still in development some parts of the code is not structured as I would like it, 
	eg hardcorded test data, using ğ”½â‚†â‚„ instead of â„•â‚ƒâ‚‚ is some places 
âis

	learningRate : ğ”½â‚†â‚„
	bias : ğ”½â‚†â‚„
	
	âŸ¦publicâŸ§
    weights : FeatureVector4D

    âŸ¦publicâŸ§
	init (learningRate : ğ”½â‚†â‚„)  is
		self.learningRate â† learningRate 
        self.weights â† FeatureVector4D(0.0, 0.0, 0.0, 0.0)
		debugWriteLine("init Perceptron")
    end
	
	method activate(value : ğ”½â‚†â‚„) â†’ ğ”½â‚†â‚„ is
		output :  ğ”½â‚†â‚„ â† 0.0
		if value â‰¥ 0.0 then 
			output â† 1.0
		end
		return output
	end
	
	method predict(input : FeatureVector4D) â†’ ğ”½â‚†â‚„ is
		sum : ğ”½â‚†â‚„ â† weights â‹… input + bias
		return activate(sum)
	end
	
	method train(training_inputs : ArrayâŸ¦FeatureVector4DâŸ§, labels : MemorySegmentâŸ¦ğ”½â‚†â‚„âŸ§, elementCount : â„•â‚ƒâ‚‚, epochs : â„•â‚†â‚„) â†’ () is
		for epoch âˆˆ âŸ¨1, â€¦, epochsâŸ© do
			errors : â„•â‚ƒâ‚‚ â† 0
			for i âˆˆ âŸ¨1, â€¦, elementCountâŸ© do
				input : FeatureVector4D â† training_inputs[i]
				label :â† labels[i]
				
				Â¶showInputAndLabel(input, label, epoch)  
				
				prediction : ğ”½â‚†â‚„ â† self.predict(input)
				error :â† label âˆ’ prediction
				if error â‰  0.0 then
					self.weights â† self.weights + input â‹… (self.learningRate â‹… error)
					self.bias â† self.bias + self.learningRate â‹… error
					errors â† errors + 1
				end
			 end
			
			Â¶showBiasLearningRateAndWightsOfEpoch(epoch, bias, learningRate,weights)
			
		end
	end
	
	method showBiasLearningRateAndWightsOfEpoch (epoch : â„•â‚†â‚„, errors : ğ”½â‚†â‚„, bias : ğ”½â‚†â‚„, learningRate : ğ”½â‚†â‚„, weights  : FeatureVector4D) â†’ () is
		debugWrite("Epoch ")
		debugWrite(epoch)
		debugWrite(": Fehler =")
		debugWriteLine(errors)
		
		debugWrite("Epoch ")
		debugWrite(epoch)
		debugWrite(": Bias =")
		debugWriteLine(bias)
			
		debugWrite("Epoch ")
		debugWrite(epoch)
		debugWrite(": LearningRate = ")
		debugWriteLine(learningRate)		
		
		debugWrite("Epoch ")
		debugWrite(epoch)
		debugWrite(": Weights = ")
		debugWrite(weights.x)
		debugWrite(", ")
		debugWrite(weights.y)
		debugWrite(", ")
		debugWrite(weights.z)
		debugWrite(", ")
		debugWriteLine(weights.d)
	end
		
	method showInputAndLabel(input  : FeatureVector4D, label : ğ”½â‚†â‚„,epoch : â„•â‚†â‚„)  â†’ () is
		debugWrite("Epoch ")
			debugWrite(epoch)
			debugWrite(": input = ")
			debugWrite(input.x)
			debugWrite(", ")
			debugWrite(input.y)
			debugWrite(", ")
			debugWrite(input.z)
			debugWrite(", ")
			debugWrite(input.d)
			debugWrite("     type =  ")
			debugWriteLine(label)		
	end
end object	
